<html>
<head>
  <link href="style.css" rel="stylesheet" type="text/css"/>
  <title>6502 assembler and emulator</title>
  <meta charset="utf-8"/>
</head>
<body>
  <div class="btn-bar">
    <input type="button" value="Compile" id="compileButton" onClick="compileCode()"/>
    <input type="button" value="Run" id="runButton" onClick="cpu.runBinary()"/>
    <input type="button" value="Reset" id="resetButton" onClick="reset()"/>
    <input type="button" value="Hexdump" id="hexdumpButton" onClick="hexDump()"/>

    <select id="fileSelect" onChange="load(this.options[this.selectedIndex].value)">
      <option>Examples</option>
      <option value="adventure.asm"">adventure.asm</option>
      <option value="alive.asm"">alive.asm</option>
      <option value="backandforth.asm"">backandforth.asm</option>
      <option value="byterun.asm"">byterun.asm</option>
      <option value="calculator.asm"">calculator.asm</option>
      <option value="colors.asm"">colors.asm</option>
      <option value="compo-May07-1st.asm"">compo-May07-1st.asm</option>
      <option value="compo-May07-2nd.asm"">compo-May07-2nd.asm</option>
      <option value="compo-May07-3rd.asm"">compo-May07-3rd.asm</option>
      <option value="demoscene.asm"">demoscene.asm</option>
      <option value="disco.asm"">disco.asm</option>
      <option value="fullscreenlogo.asm"">fullscreenlogo.asm</option>
      <option value="gameoflife.asm"">gameoflife.asm</option>
      <option value="noise.asm"">noise.asm</option>
      <option value="random.asm"">random.asm</option>
      <option value="rle.asm"">rle.asm</option>
      <option value="rorshach.asm"">rorshach.asm</option>
      <option value="screenpatterns.asm"">screenpatterns.asm</option>
      <option value="selfmodify.asm"">selfmodify.asm</option>
      <option value="sierpinski.asm"">sierpinski.asm</option>
      <option value="skier.asm"">skier.asm</option>
      <option value="softsprites.asm"">softsprites.asm</option>
      <option value="spacer.asm"">spacer.asm</option>
      <option value="splashscreen.asm"">splashscreen.asm</option>
      <option value="starfield2d.asm"">starfield2d.asm</option>
      <option value="triangles.asm"">triangles.asm</option>
      <option value="zookeeper.asm"">zookeeper.asm</option>
    </select>
  </div>

  <table>
    <tr>
      <td valign="top">
        <div class="cursor">&nbsp;</div>
        <textarea class="code" id="code" onKeyPress="disableButtons()"></textarea>
      </td>
      <td>&nbsp;</td>
      <td valign="top">
        <div class="cursor">&nbsp;</div>
        <canvas class="screen" id="screen"></canvas>
        <div class="registers" id="registers"></div>
      </td>
      <td>&nbsp;</td>
      <td valign="top">
        <div class="cursor">&nbsp;</div>
        <div class="screen_setup">
          <table>
            <tr>
              <td><input type="radio" id="32" name="res"/></td>
              <td><label for="32">&nbsp;32x32&nbsp;&nbsp;&nbsp;<span>$0200-$05ff</span></label></td>
            </tr>
            <tr>
              <td><input type="radio" id="48" name="res"/></td>
              <td><label for="48">&nbsp;48x48&nbsp;&nbsp;&nbsp;<span>$2000-$28ff</span></label></td>
            </tr>
            <tr>
              <td><input type="radio" id="64" name="res"/></td>
              <td><label for="64">&nbsp;64x64&nbsp;&nbsp;&nbsp;<span>$2000-$2fff</span></label></td>
            </tr>
            <tr>
              <td><input type="radio" id="80" name="res"/></td>
              <td><label for="80">&nbsp;80x80&nbsp;&nbsp;&nbsp;<span>$2000-$38ff</span></label></td>
            </tr>
            <tr>
              <td><input type="radio" id="96" name="res"/></td>
              <td><label for="96">&nbsp;96x96&nbsp;&nbsp;&nbsp;<span>$2000-$43ff</span></label></td>
            </tr>
            <tr>
              <td><input type="radio" id="128" name="res"/></td>
              <td><label for="128">128x128&nbsp;&nbsp;<span>$2000-$5fff</span></label></td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>

  <div>
    <div class="messages" id="messages"/>
  </div>

  <br/>

  <script type="text/javascript" src="ram.js"></script>
  <script type="text/javascript" src="cpu6502.js"></script>
  <script type="text/javascript" src="display.js"></script>
  <script type="text/javascript" src="assembler.js"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
      'use strict';

      document.getElementsByClassName("screen_setup")[0].addEventListener("change", function(event) {
        var screen = document.getElementById("screen");
        var registers = document.getElementById("registers");
        var res = parseInt(event.target.id, 10);
        switch(res) {
          case 32:
            screen.width = 384;   // 12 * 32
            screen.height = 288;  //  9 * 32
            registers.setAttribute("style","height:92px; width:384px");
            display.set_resolution(screen, 32, 32, 0x0200);
            display.refresh();
            break;
          case 48:
            screen.width = 384;   //  8 * 48
            screen.height = 288;  //  6 * 48
            registers.setAttribute("style","height:92px; width:384px");
            display.set_resolution(screen, 48, 48, 0x2000);
            display.refresh();
            break;
          case 64:
            screen.width = 384;   //  6 * 64
            screen.height = 256;  //  4 * 64
            registers.setAttribute("style","height:124px; width:384px");
            display.set_resolution(screen, 64, 64, 0x2000);
            display.refresh();
            break;
          case 80: // leave this?
            screen.width = 400;   //  5 * 80
            screen.height = 240;  //  3 * 80
            registers.setAttribute("style","height:140px; width:400px");
            display.set_resolution(screen, 80, 80, 0x2000);
            display.refresh();
            break;
          case 96:
            screen.width = 384;   //  4 * 96
            screen.height = 288;  //  3 * 96
            registers.setAttribute("style","height:92px; width:384px");
            display.set_resolution(screen, 96, 96, 0x2000);
            display.refresh();
            break;
          case 128:
            screen.width = 384;   //  3 * 128
            screen.height = 256;  //  2 * 128
            registers.setAttribute("style","height:124px; width:384px");
            display.set_resolution(screen, 128, 128, 0x2000);
            display.refresh();
            break;
        }

//        context.fillStyle = "#000000";
//        context.fillRect(0, 0, screen.width, screen.height);
//
//        var pixelWidth = Math.floor(screen.width / res);
//        var pixelHeight = Math.floor(screen.height / res);
//        context.fillStyle = "#ffff00";
//        for(var x=0; x<res; x++) {
//          context.fillRect(x*pixelWidth, x*pixelHeight, pixelWidth, pixelHeight);
//          context.fillRect(screen.width-(x+1)*pixelWidth, x*pixelHeight, pixelWidth, pixelHeight);
//        }
      });

      var rbtn = document.querySelector("input[name=res]:checked");
      if(rbtn) {
        rbtn.checked = false;
      }
      else {
        rbtn = document.getElementById("64");
      }
      rbtn.click();

    }, false);
  </script>

</body>
</html>
